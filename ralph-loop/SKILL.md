---
name: ralph-loop
description: "Autonomous AI coding workflow using fresh context per iteration. Use when user asks to (1) Set up Ralph Loops, (2) Create specs or prompts for autonomous coding, (3) Initialize autonomous coding workflows, (4) Run Ralph or similar autonomous coding requests"
---

# Ralph Loop

Autonomous coding via a dumb bash loop that keeps restarting Claude with fresh context. Each iteration reads the plan, picks one task, implements it, commits, and exits. The loop restarts. Eventual consistency through iteration.

## Three Phases

### Phase 1: Define Requirements (human + LLM conversation)

Bidirectional planning conversation. Do NOT manually write specs — generate through discussion.

1. Discuss project ideas, identify Jobs to Be Done (JTBD)
2. Break each JTBD into topics of concern (one sentence without "and")
3. LLM writes `specs/FILENAME.md` for each topic of concern

**One spec per topic.** Format is up to the LLM. Focus on requirements and acceptance criteria.

### Phase 2: Planning Mode (Ralph generates the plan)

```bash
./loop.sh plan
```

Ralph studies specs + existing code, does gap analysis, creates/updates `IMPLEMENTATION_PLAN.md`. No implementation. Often completes in 1-2 iterations.

### Phase 3: Building Mode (Ralph implements from plan)

```bash
./loop.sh
```

Each iteration: orient → read plan → select task → investigate → implement → validate → update plan → update AGENTS.md → commit. Fresh context each time.

## File Layout

```
project-root/
├── loop.sh              # Ralph loop script (plan/build modes)
├── PROMPT_plan.md       # Planning mode prompt
├── PROMPT_build.md      # Building mode prompt
├── AGENTS.md            # Operational guide (build/test commands)
├── IMPLEMENTATION_PLAN.md  # Generated by Ralph (not a template)
├── specs/               # One spec per topic of concern
│   └── *.md
└── src/                 # Application source code
```

## Setup

```bash
scripts/init_ralph.sh /path/to/project
```

Creates all files except `IMPLEMENTATION_PLAN.md` (Ralph generates that in planning mode).

After init:
1. Edit `PROMPT_plan.md` — replace `[project-specific goal]`
2. Edit `AGENTS.md` — add build/test/lint commands
3. Write specs in `specs/` (one per topic of concern)
4. `./loop.sh plan` — generates IMPLEMENTATION_PLAN.md
5. `./loop.sh` — builds from plan

## Key Concepts

### AGENTS.md

Concise operational guide loaded every iteration. NOT a changelog. Contains:
- How to build/run the project
- Validation commands (tests, typecheck, lint)
- Operational learnings
- Codebase patterns

The build prompt says "run tests" generically — AGENTS.md specifies actual commands. This is how backpressure gets wired per-project.

### Subagent Strategy

Main context = scheduler. Don't pollute it with expensive work.
- Fan out to Sonnet subagents for reads/searches (up to 500)
- Only 1 subagent for build/tests (backpressure control)
- Opus subagents for complex reasoning (debugging, architecture)

### Backpressure

Tests, typechecks, lints, and builds reject invalid work. The prompt instructs Ralph to run tests; AGENTS.md specifies the actual commands.

### Key Language Patterns

These phrasings from the official guide are deliberate:
- "study" (not "read") — deeper engagement
- "don't assume not implemented" — prevents duplicate work
- "using parallel subagents" / "up to N subagents"
- "Ultrathink" — extended reasoning
- "capture the why"
- "resolve them or document them"

### The 9s Pattern (Guardrails)

Build prompt uses escalating numbers (99999, 999999, ...) for guardrails. Higher number = more critical invariant. These are instructions that must be followed regardless of other context.

## Loop Mechanics

`loop.sh` supports two modes:

| Usage | Mode | What happens |
|---|---|---|
| `./loop.sh plan` | Planning | Uses PROMPT_plan.md, gap analysis only |
| `./loop.sh plan 5` | Planning | Max 5 iterations |
| `./loop.sh` | Building | Uses PROMPT_build.md, implements from plan |
| `./loop.sh 20` | Building | Max 20 iterations |

Each iteration: `cat PROMPT.md | claude -p --dangerously-skip-permissions`

No marker file — Claude exits naturally, bash loop restarts. Git push after each iteration.

## Steering Ralph

- **Upstream**: Deterministic setup. Specs, prompts, utilities in codebase shape what gets generated.
- **Downstream**: Backpressure via tests/builds rejects bad work.
- **Observe and adjust**: Watch early iterations. When Ralph fails a specific way, add guardrails.
- **Plan is disposable**: If wrong, delete it, run `./loop.sh plan` again. Cheap to regenerate.
